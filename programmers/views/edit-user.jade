extends layout

block content
  h1= title

  form(id="edit-form")
    div
      label(for="userID") UserID:
      input(type="text", name="userID", value=user.userID, required)
    div
      label(for="password") New Password (변경할 경우에만 입력):
      input(type="password", name="password", placeholder="Enter new password")
    div
      button(type="submit") 수정 완료
  
  br
  a(href="/users") 목록으로 돌아가기

  script.
    const userId = !{user.id};
    const form = document.getElementById('edit-form');

    form.addEventListener('submit', function(event) {
      event.preventDefault(); 
      const userID = event.target.elements.userID.value;
      const password = event.target.elements.password.value;

      const bodyData = {
        userID: userID,
      };

      if (password) {
        bodyData.password = password;
      }

      fetch(`/users/${userId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(bodyData),
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(data => {
            alert('수정 실패: ' + (data.message || '알 수 없는 오류'));
            throw new Error(data.message);
          });
        }
        return response.json();
      })
      .then(data => {
        console.log('수정 성공:', data);
        alert(data.message);
        window.location.href = '/users';
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });